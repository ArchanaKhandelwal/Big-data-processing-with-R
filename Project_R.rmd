---
title: "Paris Airbnb analysis"
author: "Archana Khandelwal"
date: "27/03/2024"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Introduction and Objectives
Every night, hundreds of thousands of tourists opt to pay for and stay in accommodations provided by strangers through the Airbnb website instead of booking traditional lodging such as hotels. Since its inception in 2008, Airbnb has offered an online platform where individuals can rent various types of properties, including rooms, apartments, houses, and occasionally more unique accommodations. Over the years, Airbnb has experienced rapid and extensive growth, making it possible for anyone to find and rent a place virtually anywhere in the world.

This report focuses on Paris, the capital of France, aiming to analyze general trends regarding the prices set by hosts in the city. Our analysis is structured around four main objectives. Firstly, we aim to identify the relationship between prices and apartment features, with a specific emphasis on understanding how various factors such as size, amenities, and location influence rental rates. Secondly, we will delve into the habits of Parisian hosts, seeking to determine the typical number of apartments each owner offers for rent, providing insights into the scale of their operations. Thirdly, we will adopt a geographical approach to assess the renting prices per city quarter, known as "arrondissements," examining how different areas within Paris correlate with varying price ranges. Finally, we will longitudinally examine the visit frequency of the different quarters over time, providing insights into the popularity and demand dynamics of various neighborhoods in Paris among Airbnb users.



### Folders and Files
The exercise comprises the following folders and files:
- The `app.R` R script, which contains the Shiny web application including both the server and the user interface.
- The data provided for the development of this exercise is stored in an .RData file named `AirBnB.RData`. This file contains data related to Airbnb listings in Paris.

### Exercise Tasks
For this exercise, the objective is to explore and analyze the Paris dataset by creating a Shiny application. The application should include the following functionalities:

1. **Relationship between Prices and Apartment Features:**
   Analyze the relationship between rental prices and various apartment features such as the number of bedrooms, bathrooms, beds, and capacity to accommodate guests. Visualize this relationship through interactive plots or charts.

2. **Number of Apartments per Owner:**
   Calculate and display the number of apartments owned by each host. This analysis provides insights into the distribution of listings among different property owners.

3. **Renting Price per City Quarter ("Arrondissements"):**
   Explore the renting prices across different city quarters (arrondissements) in Paris. Analyze the variation in prices and identify areas with higher or lower rental rates. Visualize this information using interactive maps or charts.

4. **Visit Frequency of Different Quarters According to Time:**
   Determine the frequency of visits to different city quarters over time. Analyze trends in visitor activity and identify popular quarters during specific periods. Visualize visit frequency using different plots.

The Shiny application should provide an intuitive and user-friendly interface for users to interact with the data and explore various insights related to Airbnb listings in Paris.

### Approach

In this analysis, we considered several key features present in the dataset to gain insights into the Airbnb listings. The features investigated are as follows:

- **Room Type**: The type of room offered in the listing, such as entire home/apartment, private room, or shared room.
- **Property Type**: The type of property being listed, including apartments, houses, condominiums, and others.
- **Neighborhood**: The specific neighborhood or area in which the property is located, providing insight into the geographical distribution of listings.
- **Price**: The rental price associated with each listing, allowing for the examination of pricing trends and variations.
- **Type of Owner**: Differentiating between regular hosts and superhosts, who have earned recognition from Airbnb for their exceptional hosting standards.
- **Location of Listings**: Geographic coordinates or other location data, enabling spatial analysis and visualization of listing distribution.

By analyzing these features, we aimed to uncover patterns, trends, and relationships within the dataset, providing valuable insights into the Airbnb market in the study area. The findings from this analysis can inform various stakeholders, including hosts, guests, and policymakers, in making informed decisions related to Airbnb accommodations.



### Software and packages


```{r}


library(DataExplorer)
library(skimr)
library(tidyr)
library(shiny)
library(dplyr)
library(stringr)
library(ggplot2)
library(tidyverse)
library(ggmap)
library(ggpubr)
library(writexl)
library(plotly)
library(lubridate)
library(leaflet)
library(corrplot)
library(highcharter)
library(kableExtra)
library(here)
library(zoo)
library(gridExtra)


```


### Preprocessing the dataset

First, load the dataset:

```{r}
org_data <- load("D:/Archana DSTI/Big Data Processing with R/AirBnB.Rdata")               
org_data
```
Two lists are retrieved with names `L` and `R`

When you run "View(L) and View(R) " commands, you'll see the data from the data frames L and R displayed in a visual format directly within the R environment. This makes it easier for you to look at the data and understand what it contains, helping you explore and make sense of it more effectively.

```{r}

View(L)
View(R)
```


We observe the following:

- The list **L** contains 95 variables of different types.
- The list **R** contains only two variables.

**L** will be utilized for analyzing features, while **R** will be employed to compute the visit frequency of different quarters over time.

**Generate a summary of the dataset L using the skim() function**
```{r}
skim(L)
```
-- Variable type: factor -----------
A tibble: 64 x 6

-- Variable type: logical ----------
A tibble: 2 x 5

-- Variable type: numeric ----------
A tibble: 29 x 11


It also gives us a glimpse of the missing values, the unique values etc. 


### Data Processing 

We begin by listing all the columns from **L** dataset.

```{r}
colnames(L)
```
In order to preserve the original dataset, we will creqte a new one, called **New_data** to keep only the relevant columns.

Using the `select` clause, a subset of the `L` dataset is created to use only the variables (out of the 95) 
that will be useful for the project:

```{r}
New_data <- select(L, listing_id =id, Host_id= host_id, Host_name= host_name, bathrooms, bedrooms, beds, bed_type, Equipments= amenities, Property_type= property_type, Room_type= room_type, Nb_of_guests= accommodates,Price= price, guests_included, minimum_nights, maximum_nights,availability_over_one_year= availability_365, instant_bookable, cancellation_policy, city, Adresse= street, Neighbourhood=neighbourhood_cleansed, city_quarter=zipcode, latitude, longitude, security_deposit, transit, host_response_time, Superhost= host_is_superhost, Host_since= host_since, Listing_count= calculated_host_listings_count, Host_score= review_scores_rating, reviews_per_month,number_of_reviews,square_feet)

```

**Retrieve the column names of the New_data dataframe**
```{r}

colnames(New_data)
```

**Remove duplicate entries from the dataset** 

Also, the `$` sign in the prices will give us problem when manipulating the numbers so it needs to be removed as well:

```{r}
New_data <- New_data %>% distinct(listing_id, .keep_all = TRUE)
```

To be able to manipulate them like numeric ones, we need to ensure that they are loaded with the appropriate data type, especially the "Price" column. 

For this particular column, we see that :

- it's factor typed (fct) : it's a vector that can contain only predefined values, and is used to store categorical data.
- the '$' sign is a character that we need to remove. 


```{r}
# Removing the "$" character
New_data$Price <- substring(gsub(",", "", as.character(New_data$Price)),2)
```

**Let's take a glimpse at 'Price' column in the New_data dataframe to verify that the $ symbol is removed**

```{r}
glimpse(New_data[,"Price"])
```

### Data Type Conversion

Let's take a look into the data types in the 'New_data' dataset.

```{r}
data_types <- data.frame(Column_Name = names(New_data), Data_Type = sapply(New_data, class))
print(data_types)
```

To ensure that the variables have appropriate data type, we need to apply data type conversions as following:

**1. Converting to numeric columns:**

```{r}
# Changing the data type
New_data$bedrooms <- as.numeric((New_data$bedrooms))
New_data$beds <- as.numeric((New_data$beds))
New_data$Price <- as.numeric((New_data$Price))
New_data$guests_included <- as.numeric((New_data$guests_included))
New_data$minimum_nights <- as.numeric((New_data$minimum_nights))
New_data$maximum_nights <- as.numeric((New_data$maximum_nights))
New_data$availability_over_one_year <- as.numeric((New_data$availability_over_one_year))
New_data$security_deposit <- as.numeric((New_data$security_deposit))
New_data$Listing_count <- as.numeric((New_data$Listing_count))
New_data$Host_score <- as.numeric((New_data$Host_score))
New_data$number_of_reviews <- as.numeric((New_data$number_of_reviews))
New_data$square_feet <- as.numeric((New_data$square_feet))
```

**2. Converting to character columns:**

```{r}
New_data$Neighbourhood <- as.character(New_data$Neighbourhood)
```

**3. Converting to date columns**
```{r}
New_data$Host_since <- as.Date(New_data$Host_since)
```

Finally, let's ensure the data types are updated.

```{r}
data_types <- data.frame(Column_Name = names(New_data), Data_Type = sapply(New_data, class))
print(data_types)
```

**Removing Outliers**


```{r}
summary(New_data$Price)
```
 
A quick computation using the R summary() function – as done above – shows that the minimum price is $0 and the maximum is $6081. Although human kindness is limitless, free rent do not exist in AirBnB. Additionally, it sounds unreasonable to spend $6081 to rent a property for one night. At the time of writing, a quick request for renting in Paris using AirBnB website revealed that the range of price goes from around $20 to approximatively $1300. Consequently we will use these values as range for the variable price and remove the outliers.

![Airbnb web page](D:/Archana DSTI/Big Data Processing with R/Airbnb.png)




```{r}
# Setting the price range
New_data <- New_data %>%
filter(New_data$Price >= 20 &
       New_data$Price <= 1300)
```


```{r}
summary(New_data$Price)
```

After cleaning up the dataset, we can see that median of price is still $75 with a minimum at $20 and and a maximum at $1285.


**Quantifying missing values**

In a first step we are going to assess the robustness and relevance of the selected data by notably assessing the amount of missing values present in each variable.


```{r}
# Count missing values for all columns
missing_counts <- colSums(is.na(New_data))

# Print the results
missing_counts
```


Here we found that 95% of values present in the square_feet variable correspond to missing data. A very small proportion of values in bedrooms and bathrooms columns are also missing. This observation prompts us to  unambiguously suppress the square_feet variable from airbnb_data. In contrast, handling missing values for bedrooms and bathrooms requires a bit of a discussion. Indeed, we could use different approaches here. First, we could fill the missing values by replacing them with the most representative value. As the variables 'bedrooms' and 'bathrooms' are categorical, we could use the mean to fill in the missing values with it. Another approach could be to simply remove these rows from the dataset as they represent so little. This will not affect the overall dataset and analysis. 

**Fill in missing value**

The approach followed in this case is to fill the missing values with the mean value of the corresponding column (bathrooms, bedrooms and beds):

```{r}
#Bathrooms
# Calculate the mean value of the "bathrooms" column
mean_value <- mean(New_data$bathrooms, na.rm = TRUE)
# Replace missing values with the mean value
New_data$bathrooms <- na.aggregate(New_data$bathrooms)
# Calculate the mean value again to see the value with which missing values were filled
mean_value_filled <- mean(New_data$bathrooms)
print(paste("Value with which missing values are filled:", mean_value_filled))
```

```{r}
#Bedrooms
# Calculate the mean value of the "bedrooms" column
mean_value_bedrooms <- mean(New_data$bedrooms, na.rm = TRUE)
# Replace missing values with the mean value
New_data$bedrooms <- na.aggregate(New_data$bedrooms)
# Calculate the mean value again to see the value with which missing values were filled
mean_value_filled_bedrooms <- mean(New_data$bedrooms)
print(paste("Value with which missing values are filled", mean_value_filled_bedrooms))
```

```{r}
#Beds
# Calculate the mean value of the "beds" column
mean_value_beds <- mean(New_data$beds, na.rm = TRUE)
# Replace missing values with the mean value
New_data$beds <- na.aggregate(New_data$beds)
# Calculate the mean value again to see the value with which missing values were filled
mean_value_filled_beds <- mean(New_data$beds)
print(paste("Value with which missing values are filled", mean_value_filled_beds))
```


In this analysis, we extracted distinct values from the "Neighbourhood" column of the New_data dataframe, checking for any spelling variations or inconsistencies across neighborhoods. The resulting list provides a comprehensive overview of unique neighborhood names within the dataset.

```{r}
# Get distinct values from the "Neighbourhood" column in the New_data dataframe
distinct_neighbourhoods <- unique(New_data$Neighbourhood)
distinct_neighbourhoods_list <- as.list(distinct_neighbourhoods)
distinct_neighbourhoods_list
```

**City_quarter Column cleaning**

```{r}
# Cleaning the city quarters (Arrondissements):
New_data$city = str_sub(New_data$city,1, 5)
New_data$city_quarter = str_sub(New_data$city_quarter, -2)
New_data <- subset(New_data, New_data$city == 'Paris' & New_data$city_quarter != "" & New_data$city_quarter <= 20 & New_data$city_quarter != '00' & New_data$city_quarter != ' ')
```

```{r}
unique_values <- unique(New_data$city_quarter)

# Prinitng unique values of the city quarters (arrondissements)
print(unique_values)

```

The subset of the New_data dataset comprises records corresponding to properties located in Paris. Specifically, it includes entries where the city quarter (or arrondissement) information is available and falls within the range of 01 to 20, excluding '00'. This filtering ensures that only relevant data related to properties situated in Paris and categorized within valid city quarters (Arrondissements) is retained for further analysis.

**The data is now cleaned, let's have a look at the first rows of our new dataset and also the summary**

```{r}
head(New_data)
```

:
```{r}
summary(New_data)
```

## <u>Analysis</u>

### Relationship between Prices and Apartment Features

As a customer, the primary consideration when renting a place is the price. The variability in prices is inherently influenced by the type of property and room being rented. For instance, a shared room in a dormitory may have a different price range compared to a shared room in a large villa. Similarly, renting a full apartment is expected to be more expensive than renting a single room. To gain a deeper understanding of pricing dynamics in Paris, we first investigate the Airbnb dataset from this perspective. Our aim is to decipher the key factors influencing property prices and, specifically, identify the features that most significantly impact apartment prices offered by Airbnb hosts in Paris.

***The Parisian offering on Airbnb is predominantly composed of entire apartments available for rent***

To streamline our analysis and focus on relevant features, we aim to reduce the size of our dataset. Assuming that a rented property features commonly include equipped kitchen, television, wifi or internet, sofa, etc., we prioritize selecting key attributes that customers typically consider when renting a place. These include the type of room or property, as well as the number of rooms and bathrooms, which are among the most salient factors influencing rental decisions.

```{r}
features_and_price <- New_data %>%
  select(Property_type,
         Room_type,
         bathrooms,
         bedrooms,
         beds,
         Neighbourhood,
         Nb_of_guests,
         Price)

View(features_and_price)
```


**Correlation between Price and Apartment Features**
```{r}
# Plot the correlation matrix
cor_featuer_and_price <- features_and_price[, sapply(features_and_price, is.numeric)]
cor_featuer_and_price <- cor_featuer_and_price[complete.cases(cor_featuer_and_price), ]
correlation_matrix <- cor(cor_featuer_and_price, method = "spearman")
corrplot(correlation_matrix, method = "color", main = "")



```

Target variable Price has positive correlation with : bathrooms, beds, bedrooms, and number of guests. Thus, we can analyze the relationship between the price and some of these variables.


```{r}
p1<- ggplot(features_and_price) + 
  geom_histogram(aes(Price), fill = "#971a4a", alpha = 0.85, binwidth = 15) + 
  theme_minimal(base_size = 13) + 
  xlab("Price") + 
  ylab("Frequency") + 
  ggtitle("Distribution of Price")

p2 <- ggplot(features_and_price, aes(Price)) +
  geom_histogram(bins = 30, aes(y = ..density..), fill = "#971a4a") + 
  geom_density(alpha = 0.2, fill = "#971a4a") + 
  ggtitle("Logarithmic distribution of Price", subtitle = expression("With" ~'log'[10] ~ "transformation of x-axis")) + 
  scale_x_log10()


ggarrange(p1,
          p2,
          nrow = 1,
          ncol=2,
          labels = c("1. ", "2. "))

```

In the logarithmic distribution of the variable price a better insight view of this variable can be perceived.
The distribution is not gaussian but remains less skewed . Next we will investigate if prices are different between property types and room types proposed in Paris by AirBnB hosts. 

### <u>Price & Types of listings</u>

### Analysis by Room type

Let’s analyze more closely the total count for each distinct room type.


```{r}


# Count the total number of occurrences for each distinct room type
room_type_counts <- features_and_price %>%
  group_by(Room_type) %>%
  summarize(Total_Count = n())

# Print the total count for each distinct room type
print(room_type_counts)


```

Now, let's plot the distribution of room types in the dataset using a polar bar chart, making it easier to compare the relative frequencies of different room types.

```{r}
room_types_counts <- table(features_and_price$Room_type)
room_types <- names(room_types_counts)
counts <- as.vector(room_types_counts)
percentages <- scales::percent(round(counts/sum(counts), 2))
room_types_percentages <- sprintf("%s (%s)", room_types, percentages)
room_types_counts_df <- data.frame(group = room_types, value = counts)

res2 <- ggplot(room_types_counts_df, aes(x = "", y = value, fill = room_types_percentages)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_brewer("Room Types", palette = "BuPu") +
  ggtitle("Distribution of Room types") +
  theme(plot.title = element_text(color = "black", size = 12, hjust = 0.5)) +
  ylab("") +
  xlab("") +
  labs(fill="") +
  theme(axis.ticks = element_blank(), panel.grid = element_blank(), axis.text = element_blank()) +
  geom_text(aes(label = percentages), size = 5, position = position_stack(vjust = 0.5))

res2
```

From the plot we can deduce that people generally tend to rent the entire apartment which comprise 86% of the total distribution followed by private rooms (13%) and shared room (1%).

**Distribution of the price for each room type**

```{r}
ggplot(features_and_price) +  
  geom_boxplot(aes(x = Room_type,y = Price,fill = Room_type)) +
  labs(x = "Room Type",y = "Price",fill = "Room Type") +  
  coord_flip()
```

The price increases in this order: shared room > private room > entire home/apt. Let’s have a look at the average price by room type.

**Average price by Room type **

```{r}
features_and_price %>% 
     group_by(Room_type) %>% 
     summarise(mean_price = mean(Price, na.rm = TRUE)) %>% 
     ggplot(aes(x = reorder(Room_type, mean_price), y = mean_price, fill = Room_type)) +
     geom_col(stat ="identity", fill="#56478b") +
     coord_flip() +
     theme_minimal() +
     labs(x = "Room Type", y = "Price") +
     geom_text(aes(label = round(mean_price,digit = 2)), hjust = 1.0, color = "white", size = 4.5) +
     ggtitle("Average Price by Room Type") + 
     xlab("Room Type") + 
     ylab("Average Price")

```

**Distribution of Listings Under $1,000 by room type**

```{r}
ggplot(features_and_price, aes(x = Price, fill = Room_type)) +
  geom_histogram(position = "dodge") +
  scale_fill_manual(values = c("#efa35c", "#4ab8b8", "#1b3764"), name = "Room Type") +
  labs(title = "Distribution of Listings Under $1,000 by Room type", x = "Price per night", y = "Number of listings") +
  theme(plot.title=element_text(vjust=2), 
        axis.title.x=element_text(vjust=-1, face = "bold"),
        axis.title.y=element_text(vjust=4, face = "bold"))

```

This visualization offers insights into the distribution of listing prices under $1,000 per night, illustrating the composition of room types within this price range. We notice a majority of listings are between $50 to $250.


**Analysis by Property type**

Let’s analyze more closely the total count for each distinct property type.


```{r}
# Count the total number of occurrences for each distinct property type
property_type_counts <- features_and_price %>%
  group_by(Property_type) %>%
  summarize(Total_Count = n())

# Print the total count for each distinct property type
print(property_type_counts)
```

We can see that parisian hosts propose three types of rooms: Entire home/apt, Private room and Shared room. Property types are more diverse. we have some surprising propositions there as cabin, cave, chalet, earth house or igloo.
There is also a property type 'other'  where all these unexpected propositions could have been piled in. Nevertheless, considering 'other' would be vague to draw any conclusion from an analysis, we will skip it in our analysis along with those for which the count is 1. Consequently, we are going to keep only the following relevant and explicit property types to perform our analysis: Apartment, Bed & Breakfast, Boat, Condominium, Dorm, House, Loft, Townhouse, Villa. 

```{r}
list_property_types <- c("Apartment",
                         "Bed & Breakfast",
                         "Boat",
                         "Condominium",
                         "Dorm",
                         "House",
                         "Loft",
                         "Townhouse", 
                         "Villa")

features_and_price <- features_and_price %>%
  filter(Property_type %in% list_property_types)
```

```{r}
# Count the total number of occurrences for each distinct property type
property_type_counts <- features_and_price %>%
  group_by(Property_type) %>%
  summarize(Total_Count = n())

# Print the total count for each distinct property type
print(property_type_counts)
```

**Distribution by property**

We begin by plotting the distribution of property types in the dataset using a polar bar chart, making it easier to compare the relative frequencies of different property types.

```{r}

# Calculate percentages of property types
property_type_df <- features_and_price %>%
  count(Property_type) %>%
  mutate(Percentage = n / sum(n))

# Define custom colors for the pie chart
custom_colors <- c("#ffff69", "#33a02c", "#a6cee3", "#b2df8a", "#33a02c", "#fb9a99", "#e31a1c", "#fdbf6f", "#ff7f00")

# Create the pie chart
pie_chart <- ggplot(property_type_df, aes(x = "", y = Percentage, fill = Property_type)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Property Types", values = custom_colors, labels = paste0(property_type_df$Property_type, ": ", scales::percent(property_type_df$Percentage))) +
  labs(title = "Distribution of Property Types", 
       fill = "Property Types",
       y = "Percentage") +
  theme_void() +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  guides(fill = guide_legend(title = "Property Types", label.position = "right"))

# Display the pie chart
print(pie_chart)




```


We notice that apartments are the most rented out property with over 96% of distribution.


**Price distribution by property**

```{r}
ggplot(features_and_price) +  
  geom_boxplot(aes(x = Property_type, y = Price, fill = Property_type)) +
  labs(x = "Property Type", y = "Price", fill = "Property Type", title = "Price Distribution by Property Type") +  
  coord_flip()

```

This visualization enables us to depict the distribution of prices across various categories of properties.
Primarily, we notice that villa appers to be uniformly distributed in the price range 250 and 1250. The distribution appears similar with notable distinctions observed in the categories of Townhouse, Loft, House, and Bed & Breakfast, which exhibit higher-than-average rental prices.
However, given that these property types along with others, except Apartment, collectively comprise only 4% of our dataset. So, I've opted not to delve deeper into their analysis.



### Price Relationship with Accommodation Features

I have chosen to define features as the following key attributes: beds, bathrooms, bedrooms, and the number of guests.

We will now explore their relationship with the price using the visualization provided below:

```{r}
    a1<- ggplot(data=features_and_price) +
      geom_smooth(mapping = aes(x=Price,y=beds), method = 'gam', col='grey')
    a2<- ggplot(data=features_and_price) +
      geom_smooth(mapping = aes(x=Price,y=bedrooms), method = 'gam', col='blue')
    a3<- ggplot(data=features_and_price) +
      geom_smooth(mapping = aes(x=Price,y=bathrooms), method = 'gam', col='violet')
    a4<- ggplot(data=features_and_price) +  
      geom_smooth(mapping = aes(x=Price,y=Nb_of_guests), method = 'gam', col='black')
    
    ggarrange(a1, a2, a3, a4, nrow=2, ncol=2, align = "hv")
```

Let's analyze collectively the relationship distribution.

```{r}
# ggplot code
pfeatures <- ggplot(data = features_and_price) +
  geom_smooth(mapping = aes(x = Price, y = beds, col = 'beds'), method = 'gam') +
  geom_smooth(mapping = aes(x = Price, y = bedrooms, col = 'bedrooms'), method = 'gam') +
  geom_smooth(mapping = aes(x = Price, y = bathrooms, col = 'bathrooms'), method = 'gam') +
  geom_smooth(mapping = aes(x = Price, y = Nb_of_guests, col = 'Nb_of_guests'), method = 'gam') +
  ggtitle("Price versus features") + labs(y = "Features", x = "Price") +
  scale_fill_manual()

# Convert ggplot object to plotly object
pfeatures_plotly <- ggplotly(pfeatures)

# Print the interactive plot
pfeatures_plotly
 
```

We can see that the price tend to go higher as the number of features increase.

**Analyzing the relationship between Price and number of bathrooms**


```{r}
features_and_price["bathrooms"] <- features_and_price["bathrooms"] %>%
  map(., floor)

bath_distr <- (ggplot(features_and_price,
                      aes(x = Price))
               +  geom_histogram(bins = 15, 
                                 aes(y = ..density..),
                                 fill = "#66CC99")
               +  geom_density(lty = 2, color = "#fb8072")
               +  labs(title = "Distribution of prices vs Bathroom numbers",
                       x = "Price",
                       y = "Density")
               +  theme(axis.text.x = element_text(angle = 90,
                                                   hjust = 1,
                                                  vjust = 0.5),
                        axis.text.y = element_text(size = 7))
               +  facet_wrap(~ factor(bathrooms), 
                             scales = "free_y"))

bath_distr



```

It helps to visualize how prices are distributed across different numbers of bathrooms, providing insights into the relationship between these two variables in the dataset.

```{r}
apt_features_and_price_bath <- features_and_price %>%
  filter(bathrooms <= 6)

ggplot(data = features_and_price, aes(x = bathrooms, y = Price, color=bathrooms)) +
        geom_jitter(width = 0.1,height = 0.2,size=0.1)
```

For the apartments with 0 bathroom, the price is significantly low. We observe that majority of apartments rented have 1, 2, or 3 bathrooms. We can also see  that rented properties with either 1 bathroom or 2 bathrooms share the same price distribution and is normally under $500. For others, there is hardly any relation of bathroom with price, except for the apartments with 3 bathrooms which has a fair and uniform distribution between $50 and $1000.
.

**Analyzing the relationship between Price and Number of Beds**

```{r}
beds_distr <- (ggplot(features_and_price,
                      aes(x = Price))
               +  geom_histogram(bins = 15,
                                 aes(y = ..density..),
                                 fill = "#66CC99")
               +  geom_density(lty = 2,
                               color = "#fb8072")
               +  labs(title = "Distribution of prices vs Beds numbers",
                       x = "Price",
                       y = "")
               +  theme(axis.text.x = element_text(angle = 90,
                                                   hjust = 1,
                                                   vjust = 0.5),
                        axis.text.y = element_text(size = 7))
               +  facet_wrap(~ factor(beds),
                             scales = "free_y"))
beds_distr
```

```{r}
beds_box <- (ggplot(features_and_price)
            +  geom_boxplot(aes(x = factor(round(beds)),
                            y = Price, 
                            fill = factor(beds)))
            +  labs(x = "# of Beds",
                    y = "Price",
                    fill = "# of Beds")
            +  coord_flip())

bed_scatt <- (ggplot(data = features_and_price, aes(x = beds, y = Price, color=beds)) +
        geom_jitter(width = 0.1,height = 0.2,size=0.1))

ggarrange(beds_box,
          bed_scatt,
          nrow = 2,
          ncol = 1,
          labels = c("A", "B"))
```

We can observe that people tend to reserve properties with 1 to 6 beds and there is no significant relationship between price and beds. apartments zith low number of beds tend to be in the same price range as the ones with 5 or 6 beds, probably because of other features.


**Analyzing the relationship between Price and number of bedroom**
```{r}
bedroom_distr <- (ggplot(features_and_price,
                      aes(x = Price))
               +  geom_histogram(bins = 15,
                                 aes(y = ..density..),
                                 fill = "#66CC99")
               +  geom_density(lty = 2,
                               color = "#fb8072")
               +  labs(title = "Distribution of prices vs Bedrooms numbers",
                       x = "Price",
                       y = "")
               +  theme(axis.text.x = element_text(angle = 90,
                                                   hjust = 1,
                                                   vjust = 0.5),
                        axis.text.y = element_text(size = 7))
               +  facet_wrap(~ factor(bedrooms),
                             scales = "free_y"))
bedroom_distr
```
```{r}
bedroom_box <- (ggplot(features_and_price)
            +  geom_boxplot(aes(x = factor(round(bedrooms)),
                            y = Price, 
                            fill = factor(bedrooms)))
            +  labs(x = "# of Bedroom",
                    y = "Price",
                    fill = "# of Bedroom")
            +  coord_flip())

bed_scatt <- (ggplot(data = features_and_price, aes(x = beds, y = Price, color=bedrooms)) +
        geom_jitter(width = 0.1,height = 0.2,size=0.1))

ggarrange(bedroom_box,
          bed_scatt,
          nrow = 2,
          ncol = 1,
          labels = c("A", "B"))
```


The higher number of beds (meaning the higher number of guests included), the higher is the price, but it doesn’t imply a higher number of bedrooms and bathrooms. These listings (2 to 3 guests, 1 bedroom, 1 bathroom) probably refer to a private or shared room (which are cheaper).

For the listings with more than 2 bathrooms and even if the number of guests and the price keep increasing, the number of beds and bedrooms temp to reach a maximum value.

Altogether, data suggests that the number of bathrooms is not the most reliable factor to rely on to anticipate the price of an apartment on AirBnB. The number of beds or the number of guests included however seem to be more accurate in this regard. We can clearly see an increase of prices along with these two variables.

# <u>Further Analysis</u>

**Cancellation policy and host response time**

```{r}
price_cancellation_policy <- ggplot(data = New_data, 
  aes(x = cancellation_policy, y = Price, color=cancellation_policy)) +
  geom_boxplot(outlier.shape = NA) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(plot.title = element_text(color = "#971a4a", size = 12, face = "bold", hjust = 0.5))+
  coord_cartesian(ylim = c(0, 1300))

host_data_without_null_host_response_time <- subset(New_data, host_response_time != "N/A" & host_response_time != "")

price_response_time <- ggplot(data = host_data_without_null_host_response_time, 
  aes(x = host_response_time, y = Price, color = host_response_time)) + 
  geom_boxplot(outlier.shape = NA) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(plot.title = element_text(color = "#971a4a", size = 12, face = "bold", hjust = 0.5)) +
  coord_cartesian(ylim = c(0, 500))

ggarrange(price_response_time,
          price_cancellation_policy,
          nrow = 1,
          ncol = 2,
          labels = c("1. ", "2. "))
```


In the initial graph depicting the relationship between host response time and price, no discernible correlation is evident. However, upon examining the second graph, a notable influence of cancellation policy on price becomes apparent. The varying types of cancellation policies exhibit differing impacts on price, resulting in fluctuations in price levels.

**Immediate reservation**

```{r}
ggplot(data = New_data, aes(x = instant_bookable, y = Price, color = instant_bookable)) +
       geom_boxplot(outlier.shape = NA) +coord_cartesian(ylim = c(0, 500))
```

When looking at how price relates to whether a listing is instantly bookable or not, there doesn't seem to be a clear connection. The instant bookings (represented by t) share the same price variation as the property which requires host's acceptance (represented by f).

**Analyzing availability of apartment by price**

```{r}
ggplot(features_and_price, aes(x = Price)) +
  geom_histogram(binwidth = 100, fill = "skyblue", color = "black") +  # Adjust binwidth as needed
  labs(title = "Apartment Availability by Price",
       x = "Price",
       y = "Number of Apartments") +
  theme_minimal()

```

The plot above shows that there's no clear relation between the availability of apartments and their prices. However, We can say that the apartments in the price range $100 to $200 tend be significantly hosted higher in comparison to others. This is also relating to our previous analysis of distribution of average price per accommodation type.


Let's plot the relationship between price and apartment availability each day over a year to see the variance of apartments for a given period. 

```{r}
ggplot( New_data, aes(availability_over_one_year, Price)) +
  geom_point(alpha = 0.2, color = "#971a4a") +
  geom_density(stat = "identity", alpha = 0.2) +
  xlab("Availability over a year") +
  ylab("Price") +
  ggtitle("Relationship between availability over a year and price") 
```


The plot above shows that there's no clear relation between the availability of apartments over a year and their prices. The prices may fluctuate abruptly throughout the year and might depend upon other factors such as location and surroundings (lake view, beach side, downtown, etc.).

Let's understand the same variation using different plot to see if we have a clear picture on availability over a year.

```{r}
hchart(New_data$availability_over_one_year, color = "#336666", name = "Availability") %>%
  hc_title(text = "Availability of listings") %>%
  hc_add_theme(hc_theme_ffx())
```

From the graph, we can deduce that a lot of AirBnb listings are hosted between December and January, notably due to the Christmas and New Year's time.

Now when our analysis of price verses apartments is finsihed, let's explore the listings by hosts or superhosts.

# Number of apartments per owner



```{r}

# Count the number of apartments for each distinct host ID and include the host name
apartments_per_host <- New_data %>%
  group_by(Host_id, Host_name) %>%
  summarize(Num_Apartments = n_distinct(listing_id))

# Print the number of apartments for each distinct host ID along with the host name
print(apartments_per_host)


```

**Top 20 'Number of listings' by owners **

```{r}
listings_per_host <- New_data %>%
  group_by(Host_id, Host_name) %>%
  summarize(Num_Listings = n_distinct(listing_id)) %>%
  arrange(desc(Num_Listings))

# `summarise()` has grouped output by 'Host_id'. You can override using the `.groups` argument.

# Select the top 20 hosts with the highest number of listings
top_20_listings <- head(listings_per_host, 20)

# Print the table of the top 20 hosts with the highest number of listings
print(top_20_listings)



```

Plotting the distribution of hosts versus their respective listings will give us some insights. We begin by grouping the hosts to visualize better, while removing any clumsiness of distribution.

```{r}

count_by_host_1 <- New_data %>% 
    group_by(Host_id) %>%
    summarise(number_apt_by_host = n()) %>%
    ungroup() %>%
    mutate(groups = case_when(
        number_apt_by_host == 1 ~ "001",
        between(number_apt_by_host, 2, 50) ~ "002-050",
        number_apt_by_host > 50 ~ "051-153"))

count_by_host_2 <- count_by_host_1 %>%
    group_by(groups) %>%
    summarise(counting = n())

# Sort the count_by_host_2 data frame by the 'counting' column in descending order
count_by_host_2 <- count_by_host_2[order(-count_by_host_2$counting), ]

# Create bar chart for number of apartments per host
bar_num_apt_by_host <- ggplot(count_by_host_2, aes(x = groups, y = counting , fill = factor(groups))) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = counting), vjust = ifelse(count_by_host_2$groups == "001", 0.0, -0.3), size = 3) +  
  labs(title = "Number of Apartments per Host Group \n ",
       x = "Host Group",
       y = "Number of Apartments",
       fill = "Group") +
  theme_minimal()

# Create bar chart for contrast between hosts and superhosts
bar_contrast_superhost <- ggplot(New_data) +
  geom_bar(aes(x = '', fill = Superhost)) +
  labs(title = "Contrast between Hosts and Superhosts",
       x = NULL,
       y = "Count",
       fill = "Superhost") +
  theme_minimal()

# Arrange plots in a grid
grid.arrange(bar_num_apt_by_host, bar_contrast_superhost, nrow = 2)
```

In this dataset, most of the hosts have one listing (that’s the case for 41521 owners, against only 3284 that have between 2 and 50 listings and 51 to 153 owners with 15 listings).
We clearly have a minority of Superhosts in this dataset



**Table of groups of owners according to their no. of apartment **
```{r}
table_representation <- data.frame(
  Host_Group = count_by_host_2$groups,
  Number_of_Apartments = count_by_host_2$counting
 
)
table_representation
```

# Airbnb growth: Evolution of new hosts over time 

```{r}
last_date <- max(New_data$Host_since,na.rm = TRUE)
last_date
```

It provides the maximum date observed in the dataset, indicating the most recent date up to which data is available being '03-07-2016'.


**Number of hosts per year**

```{r}
new_hosts_data <- drop_na(New_data, c("Host_since"))

# Calculate the number of new hosts for each year (except for 2017 since our data is not complete for this year)
new_hosts_data$Host_since <- as.Date(new_hosts_data$Host_since, '%Y-%m-%d')
new_hosts_data <- new_hosts_data[new_hosts_data$Host_since < as.Date("2017-01-01"),]
new_hosts_data <- new_hosts_data[order(as.Date(new_hosts_data$Host_since, format="%Y-%m-%d")),]
new_hosts_data$Host_since <- format(as.Date(new_hosts_data$Host_since, "%Y-%m-%d"), format="%Y-%m")
new_hosts_data_table <- table(new_hosts_data$Host_since)

# Plot
plot(as.Date(paste(format(names(new_hosts_data_table), format="%Y-%m"),"-01", sep="")), as.vector(new_hosts_data_table), type = "l", xlab = "Time", ylab = "Number of new hosts", col = "Blue")
```


The analysis indicates that the dataset spans until 2016, limiting our ability to ascertain trends in new host numbers beyond this point. However, from 2008 to 2015, there was a discernible increase in the number of hosts. Nevertheless, in the subsequent two years, specifically from 2015 to 2017, there was a notable decline in number of host.




## Renting price per city quarter (arrondissement)


**Number of listings by neighborhood**

```{r}

# Plot for number of listings by neighborhood
listings_neighb <- ggplot(New_data, aes(x = fct_infreq(Neighbourhood), fill = Room_type)) +
  geom_bar() +
  labs(title = "Number of Listings by Neighbourhood",
       x = "Neighbourhood", y = "Number of Listings") +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 75, hjust = 1), 
        plot.title = element_text(color = "black", size = 12,  hjust = 0.5))

# Plot the bar chart
listings_neighb


```

**Average price per Neighbourhood**

```{r}
library(ggplot2)

# Calculate average daily price per city quarter
average_prices_per_arrond <- aggregate(cbind(New_data$Price),
                                       by = list(arrond = New_data$city_quarter),
                                       FUN = function(x) mean(x))

# Plot for average daily price per city quarter
price_arrond <- ggplot(data = average_prices_per_arrond, aes(x = arrond, y = V1)) +
  geom_bar(stat = "identity", fill = "lightblue", width = 0.7) +
  geom_text(aes(label = round(V1, 2)), size = 4) +
  coord_flip() +
  labs(title = "Average Daily Price per City Quarter",
       x = "City Quarters", y = "Average Daily Price") +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90, hjust = 1), 
        plot.title = element_text(color = "black", size = 12,  hjust = 0.5))

# Display the plot
print(price_arrond)

```



The most expensive districts are : 1st to 8th and the 16th. Their average price goes from around 100 to 159 dollars. It’s probably due to the fact that most of the monuments and touristic areas are either inside or nearby these districts.

Other districts have a mean price between 66 and 88 dollars. Most of the listings are located in these districts.


```{r}
New_data %>%
  group_by(Neighbourhood) %>%
  dplyr::summarize(num_listings = n(), borough = unique(Neighbourhood)) %>%
  top_n(n = 10, wt = num_listings) %>%
  ggplot(aes(x = fct_reorder(Neighbourhood, num_listings), y = num_listings, fill = borough)) +
  geom_col() +
  coord_flip() +
  labs(title = "Top 10 neighborhoods by nb. of listings", x = "Neighbourhood", y = "Nb. of listings")

```

## Visit frequency of the different quarters according to time. 


```{r}

table <- inner_join(New_data, R,by = "listing_id")
tab1 <- select(New_data,listing_id,city,city_quarter)
table = mutate(table,year = as.numeric(str_extract(table$date, "^\\d{4}")))

     
    p6 <- ggplot(table) +
      geom_bar(aes(y =city_quarter ,fill=factor(year)))+
      scale_size_area() +
      labs( x="Frequency", y="City quarter",fill="Year")+
      scale_fill_brewer(palette ="Spectral")
    
    ggplotly(p6)


```

The grapbh displays that the maximum listing was done in the year 2015. If the data for 2016 would be available after July, we would have seen a comparable figures between 2015 and 2016. We also observe that the listings are increasing each subsequent year since the inception of AirBnb gaining the popularity worldwide.


### Number of rented Apartments in Paris neighbourhood over years

**Evolution of apartments over years**

```{r}
#Convert Date type from factor to date
table["date"] <- table["date"] %>% map(., as.Date)


# Generating a table that aggregate data from data and id and count them
# to get the number of renting by host and date
longitudinal  <- table %>%
  group_by(date, Neighbourhood) %>%
  summarise(count_obs = n())
```

```{r}
time_location <- (ggplot(longitudinal,
                         aes(x = date,
                             y = count_obs,
                             group = 1))
                  +  geom_line(size = 0.5,
                               colour = "lightblue")
                  +  stat_smooth(color = "darkblue",
                                  method = "loess")
                  +  scale_x_date(date_labels = "%Y")
                  +  labs(x = "Year",
                          y = "No. Rented Appartment")
                  +  facet_wrap(~ Neighbourhood))

time_location
```

The evolution of apartments over years shows similar pattern for all neighborhoods for which the listings have grown up, exceptionally for Bruttes-Montmartre and Popincourt. 

**Price range within Paris neighborhoods **

```{r}


# Filter data for Paris
paris_data <- New_data %>%
  filter(city == "Paris" & !is.na(longitude) & !is.na(latitude) & longitude != "" & latitude != "")

# Calculate average price for each neighborhood
avg_price_per_neighborhood <- paris_data %>%
  group_by(Neighbourhood) %>%
  summarize(Avg_Price = mean(Price))

# Create the violin plot
violin_plot <- ggplot(paris_data, aes(x = Neighbourhood, y = Price, fill = Neighbourhood)) +
  geom_violin() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(title = "Price Range within Paris Neighborhoods", x = "Neighbourhood", y = "Price") +
  scale_fill_manual(values = rainbow(length(unique(paris_data$Neighbourhood))), 
                    guide = guide_legend(title = "Neighbourhood (Avg. Price)"),
                    breaks = avg_price_per_neighborhood$Neighbourhood,
                    labels = paste(avg_price_per_neighborhood$Neighbourhood, " (", round(avg_price_per_neighborhood$Avg_Price, 2), ")"))

# Print the violin plot
violin_plot

```


We can see that that the price is higher around the center of Paris.

From the above plot, it is evident that certain districts, such as  Elysée, Opera, and Palais-Bourbon, exhibit a higher concentration of properties. This observation aligns with the understanding that real estate prices tend to be notably higher in these districts compared to others.

# Location of listings

### Neighborhood listings map:

This is an interactive map using Leaflet displaying the listings by neighborhood.

```{r}
df <- select(L,longitude,neighbourhood,latitude,price)

leaflet(df %>% select(longitude,neighbourhood,
                      latitude,price))%>%
  setView(lng = 2.3488, lat = 48.8534 ,zoom = 10) %>%
   addTiles() %>% 
  addMarkers(clusterOptions = markerClusterOptions()) %>%
  addMiniMap()
```

### Superhosts listings map :

This is an interactive map using Leaflet displaying the listings owned by ‘Superhosts’ (a total of 2145 meaning around 4% of the total listings).

```{r}
dfsuperhost <- select(New_data,longitude,Neighbourhood,latitude,Price)
dfsuperhost <- filter(New_data, Superhost =="t")
leaflet(dfsuperhost %>% select(longitude,Neighbourhood,
                      latitude,Price))%>%
  setView(lng = 2.3488, lat = 48.8534 ,zoom = 10) %>%
   addTiles() %>% 
  addMarkers(clusterOptions = markerClusterOptions()) %>%
  addMiniMap()
```

## Summary: Insights into Airbnb Listings in Paris

### Property Type and Price
The predominant type of Airbnb listings in Paris are entire homes or apartments. Pricing of these listings is influenced by factors such as the number of beds, bedrooms, bathrooms, and capacity to accommodate guests. The type of listing (entire home or shared space) also plays a significant role in determining price.

### Location and Pricing
There is a correlation between listing price and location. Neighborhoods with better amenities and higher desirability tend to have fewer Airbnb listings, but these listings command higher prices. Districts like Buttes-Montmartre, Popincourt, and Vaugirard are popular areas, while renowned Parisian quarters like Elysée, Palais-Bourbon, Louvre, and Luxembourg exhibit higher listing prices due to historical significance and tourist appeal.

### Superhost Status
Only a minority of hosts achieve Superhost status on Airbnb. Superhosts are recognized for providing exceptional guest experiences, as evaluated by guest reviews and other criteria. The stringent evaluation process ensures that Superhosts maintain high standards of hospitality, enhancing trust and satisfaction among guests.

## Conclusion
Our analysis underscores the intricate interplay between property attributes, location dynamics, and host reputation in shaping the Airbnb landscape in Paris. These insights provide valuable guidance for both hosts and guests navigating the vibrant short-term rental market in the city.


```{r}
sessionInfo()
```
